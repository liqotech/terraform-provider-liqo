---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "liqo_peer Resource - liqo"
subcategory: ""
description: |-
  Establishes a Liqo peering relationship between two Kubernetes clusters with automatic
  status monitoring and timeout handling. The peer resource enables unidirectional
  resource and service consumption, allowing the consumer cluster to offload workloads
  to the provider cluster.
---

# liqo_peer (Resource)

The `liqo_peer` resource establishes a Liqo peering relationship between two Kubernetes clusters. It creates a unidirectional resource and service consumption relationship where the consumer cluster (where Terraform is executed) can offload workloads to the provider cluster.

## Key Features

- **Automatic Status Monitoring**: Continuously monitors the peering status using `liqoctl info peer`
- **Configurable Timeout**: Customizable timeout for peering establishment (default: 5 minutes)
- **Error Handling**: Robust error handling with detailed status reporting
- **Status Tracking**: Real-time peer status updates (ready, establishing, error, timeout)

## Example Usage

### Basic Peering

```terraform
resource "liqo_peer" "example" {
  remote_kubeconfig = "/path/to/remote/kubeconfig"
}
```

### Advanced Configuration with Timeout

```terraform
resource "liqo_peer" "advanced" {
  remote_kubeconfig      = "/path/to/staging/kubeconfig"
  timeout                = "10m"  # Wait up to 10 minutes for peering completion
  liqo_namespace         = "liqo"
  remote_liqo_namespace  = "liqo-system"
  networking_disabled    = false
  create_virtual_node    = true
  cpu                    = "2"
  memory                 = "4Gi"
  pods                   = "100"
}
```

### Using with Namespace Offloading

```terraform
resource "liqo_peer" "provider" {
  remote_kubeconfig = "/path/to/provider/kubeconfig"
  timeout           = "5m"
}

resource "liqo_offload" "app_namespace" {
  namespace = "my-application"
  
  # Ensure peering is established before offloading
  depends_on = [liqo_peer.provider]
}
```

## Status Monitoring

The peer resource automatically monitors the peering status and updates the `peer_status` attribute:

- `establishing`: Peering is being established
- `ready`: Peering is successfully established and ready
- `error`: An error occurred during peering establishment
- `timeout`: Peering establishment timed out
- `no_peers`: No peers found (initial state)

## Timeout Behavior

If the peering establishment takes longer than the configured timeout:

1. The resource will be marked as completed with `peer_status = "timeout"`
2. A warning will be logged indicating the timeout
3. The peering process may continue in the background
4. You can check the actual status using `liqoctl info peer`

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `remote_kubeconfig` (String) Path to the remote (provider) cluster kubeconfig file

### Optional

- `timeout` (String) Timeout for peering completion (e.g., '10m')
- `skip_validation` (Boolean) Skip the validation
- `liqo_namespace` (String) Namespace where Liqo is installed in local cluster
- `remote_liqo_namespace` (String) Namespace where Liqo is installed in remote cluster
- `networking_disabled` (Boolean) Disable networking between the two clusters
- `gw_server_service_type` (String) Service type of the Gateway Server service (LoadBalancer, NodePort, ClusterIP)
- `gw_server_service_port` (Number) Port of the Gateway Server service
- `gw_server_service_nodeport` (Number) Force the NodePort of the Gateway Server service
- `gw_server_service_loadbalancer_ip` (String) IP of the LoadBalancer for the Gateway Server service
- `gw_client_address` (String) Address used by the gateway client to connect to the gateway server
- `gw_client_port` (Number) Port used by the gateway client to connect to the gateway server
- `mtu` (Number) MTU of the Gateway server and client
- `create_resource_slice` (Boolean) Create a ResourceSlice for the peering
- `resource_slice_class` (String) The class of the ResourceSlice
- `in_band` (Boolean) Use in-band authentication
- `proxy_url` (String) The URL of the proxy to use for communication with the remote cluster
- `create_virtual_node` (Boolean) Create a VirtualNode for the peering
- `cpu` (String) The amount of CPU requested for the VirtualNode
- `memory` (String) The amount of memory requested for the VirtualNode
- `pods` (String) The amount of pods requested for the VirtualNode

### Read-Only

- `peer_status` (String) Current status of the peering relationship. Possible values: "establishing", "ready", "error", "timeout", "no_peers"

## Troubleshooting

### Common Issues

1. **Timeout during establishment**: Increase the `timeout` value or check network connectivity
2. **Authentication errors**: Verify the `cluster_token` and `cluster_authurl` are correct
3. **Network connectivity**: Ensure clusters can communicate on the required ports

### Checking Status Manually

You can check the peering status manually using `liqoctl`:

```bash
liqoctl info peer -o json
```

### Logs and Debugging

Check Liqo controller logs for detailed error information:

```bash
kubectl logs -n liqo -l app.kubernetes.io/name=liqo-controller-manager
```
